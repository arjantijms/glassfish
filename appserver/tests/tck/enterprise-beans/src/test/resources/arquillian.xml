<?xml version="1.0" encoding="UTF-8"?>
<arquillian xmlns="http://jboss.org/schema/arquillian" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jboss.org/schema/arquillian https://jboss.org/schema/arquillian/arquillian_1_0.xsd">

    <engine>
        <property name="deploymentExportPath">${project.build.directory}/deployments</property>
    </engine>

    <group qualifier="glassfish" default="true">
        <container qualifier="tck-javatest" default="true">
            <configuration>
                <property name="allowConnectingToRunningServer">true</property>
                <property name="debug">true</property>
                <property name="suspend">false</property>
            </configuration>
            <protocol type="javatest">
                <property name="workDir">${tck.workDirectory}</property>
                <property name="tsJteFile">${tck.tsjte}</property>
                <property name="tsSqlStmtFile">${tck.tssql}</property>
                <property name="trace">true</property>
            </protocol>
        </container>

        <container qualifier="tck-appclient">
            <configuration>
                <property name="allowConnectingToRunningServer">false</property>
                <property name="debug">false</property>
                <property name="suspend">false</property>
            </configuration>

            <protocol type="appclient">
                <property name="runClient">true</property>
                <property name="runAsVehicle">true</property>
                <property name="clientEarDir">${tck.clientDirectory}</property>
                <property name="unpackClientEar">true</property>
                <!-- Need to populate from ts.jte command.testExecuteAppClient setting for glassfish -->
                <property name="clientCmdLineString">${java.home}/bin/java \
                    --add-opens \
                    java.base/java.lang=ALL-UNNAMED \
                    --module-path \
                    ${glassfish.home}/glassfish/lib/bootstrap \
                    --add-modules ALL-MODULE-PATH \
                    -cp \
                    ${glassfish.home}/glassfish/lib/gf-client.jar:${clientStubJar} \
                    -Djava.system.class.loader=org.glassfish.appclient.client.acc.agent.ACCAgentClassLoader \
                    -Dcom.sun.aas.configRoot=${glassfish.home}/glassfish/config \
                    -Dcts.tmp=${ts.home}/tmp \
                    -Doracle.jdbc.J2EE13Compliant=true \
                    -Doracle.jdbc.mapDateToTimestamp \
                    -Dlog.file.location=${glassfish.domain.dir}/logs \
                    -Dri.log.file.location=${glassfish.domain.dir}/logs \
                    -DwebServerHost.2=localhost \
                    -DwebServerPort.2=8080 \
                    -javaagent:${glassfish.lib.dir}/gf-client.jar=arg=-configxml,arg=${glassfish.domain.dir}/config/glassfish-acc.xml,client=jar=${clientStubJar},arg=-name,arg=${clientAppArchiveName} \
                    org.glassfish.appclient.client.AppClientGroupFacade
                </property>
                <property name="cmdLineArgSeparator">\\</property>
                <!-- Pass ENV vars here -->
                <property name="clientEnvString">PATH=${env.PATH};LD_LIBRARY_PATH=${glassfish.lib.dir};AS_DEBUG=true;
                    APPCPATH=${clientEarLibClasspath}:${glassfish.home}/glassfish/modules/security.jar</property>
                <property name="clientDir">${project.basedir}</property>
                <property name="clientStubsCmdLine">${glassfish.home}/bin/asadmin \
                    get-client-stubs \
                    --appName \
                    ${deploymentName} \
                    target
                </property>
                <property name="clientStubsJarSuffix">Client</property>
                <property name="workDir">${tck.workDirectory}</property>
                <property name="tsJteFile">${tck.tsjte}</property>
                <property name="tsSqlStmtFile">${tck.tssql}</property>
                <property name="trace">true</property>
                <property name="clientTimeout">20000</property>
            </protocol>
        </container>

        <container qualifier="tck-appclient-nostubs">
            <configuration>
                <property name="allowConnectingToRunningServer">false</property>
                <property name="debug">true</property>
                <property name="suspend">false</property>
            </configuration>

            <protocol type="appclient">
                <property name="runClient">true</property>
                <property name="runAsVehicle">true</property>
                <property name="clientEarDir">${tck.clientDirectory}</property>
                <property name="unpackClientEar">true</property>
                <!-- Need to populate from ts.jte command.testExecuteAppClient setting for glassfish -->
                <property name="clientCmdLineString">${glassfish.home}/glassfish/bin/appclient \
                    -Djdk.tls.client.enableSessionTicketExtension=false \
                    -Djdk.tls.server.enableSessionTicketExtension=false \
                    -Djava.security.policy=${glassfish.lib.dir}/appclient/client.policy \
                    -Dcts.tmp=${ts.home}/tmp \
                    -Djava.security.auth.login.config=${glassfish.lib.dir}/appclient/appclientlogin.conf \
                    -Djava.protocol.handler.pkgs=javax.net.ssl \
                    -Djavax.net.ssl.keyStore=${tck.certificateDirectory}/clientcert.p12 \
                    -Djavax.net.ssl.keyStorePassword=changeit \
                    -Djavax.net.ssl.trustStore=${glassfish.domain.dir}/config/cacerts.p12 \
                    -Djavax.xml.parsers.SAXParserFactory=com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl \
                    -Djavax.xml.parsers.DocumentBuilderFactory=com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderFactoryImpl \
                    -Djavax.xml.transform.TransformerFactory=com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl \
                    -Dorg.xml.sax.driver=com.sun.org.apache.xerces.internal.parsers.SAXParser \
                    -Dorg.xml.sax.parser=org.xml.sax.helpers.XMLReaderAdapter \
                    -Doracle.jdbc.J2EE13Compliant=true \
                    -Doracle.jdbc.mapDateToTimestamp \
                    -Dstartup.login=false \
                    -Dauth.gui=false \
                    -Dlog.file.location=${glassfish.domain.dir}/logs \
                    -Dri.log.file.location=${glassfish.domain.dir}/logs \
                    -DwebServerHost.2=localhost \
                    -DwebServerPort.2=8080 \
                    -Ddeliverable.class=com.sun.ts.lib.deliverable.cts.CTSDeliverable \
                    -jar \
                    ${clientEarDir}/${clientAppArchive}
                </property>
                <property name="cmdLineArgSeparator">\\</property>
                <!-- Pass ENV vars here -->
                <property name="clientEnvString">PATH=${env.PATH};LD_LIBRARY_PATH=${glassfish.lib.dir};AS_DEBUG=true;
                   APPCPATH=${clientEarLibClasspath}:${glassfish.home}/glassfish/modules/security.jar</property>
                <property name="clientDir">${tck.clientDirectory}</property>
                <property name="workDir">${tck.workDirectory}</property>
                <property name="tsJteFile">${tck.tsjte}</property>
                <property name="tsSqlStmtFile">${tck.tssql}</property>
                <property name="trace">true</property>
                <property name="clientTimeout">20000</property>
            </protocol>
        </container>

    </group>
</arquillian>
